<div>
    <div class="form-group m-3">
        <hs-file-upload (uploaded)="handleFileUpload($event)" [app]="app" uploader="hs-sld-upload"
            acceptedFormats=".csv">
        </hs-file-upload>
    </div>
    <div class="d-flex justify-content-end">
        <button type="button" class="btn m-1 btn-secondary" (click)="rowsCollapsed = !rowsCollapsed"
            *ngIf="dataAvailable()">{{'STATISTICS.COLLAPSE_ROWS' |
            translateHs : {app} }}</button>
    </div>
    <ng-container *ngIf="dataAvailable()">
        <p>Please tag uploaded CSV file columns as either "Variable" (your data to calculate models from), "Location", "Time" or other extra "Dimensions". Columns containing only one repeated value should be marked as "Ignore". You can also rename the "Variable" column</p>
        <table class="table table-striped table-bordered"
            style="table-layout: fixed;max-height: 500px;display: block;overflow-y: scroll;">
            <thead>
                <th *ngFor="let col of columns" style="min-width: 6em">
                    <select class="form-control form-select" style="border: none;" [(ngModel)]="uses[col]">
                        <option value="ignore">Ignore</option>
                        <option value="dimension">Dimension</option>
                        <option value="location">Location</option>
                        <option value="time">Time</option>
                        <option value="variable">Variable</option>
                    </select>
                </th>
            </thead>
            <thead style="vertical-align: middle;">
                <th *ngFor="let col of columns" [ngStyle]="uses[col] === 'dimension' ? {'min-width': '7em'} : {}">
                    <ng-container *ngIf="uses[col] !== 'variable'">
                        {{col}}
                    </ng-container>
                   <input *ngIf="uses[col] === 'variable'" class="form-control"
                        [(ngModel)]="columnAliases[col]" />
                </th>
            </thead>
            <thead style="vertical-align: middle;">
                <th *ngFor="let col of columns" class="p-0">
                    <ng-container *ngIf="uses[col] === 'dimension'">
                        <div class="m-0 p-0">
                            <select class="form-control form-select" [(ngModel)]="dimensionFilters[col]">
                                <option *ngFor="let uv of uniqueValues[col]">{{uv}}</option>
                            </select>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="uses[col] === 'time'">
                        <div class="m-0 p-0">
                            <label class="form-label">Frequency</label>
                            <select class="form-control form-select" [(ngModel)]="timeUnit"
                                (ngModelChange)="updateTime()">
                                <option value="day">Day</option>
                                <option value="week">Week</option>
                                <option value="month">Month</option>
                                <option value="quarter">Quarter</option>
                                <option value="year">Year</option>
                            </select>
                        </div>
                        <div class="m-0 p-0">
                            <label class="form-label">Format</label>
                            <select class="form-control form-select" [(ngModel)]="timeFormat"
                                (ngModelChange)="updateTime()">
                                <option value="YYYY">YYYY</option>
                                <option value="YYYY-MM">YYYY-MM</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                <option value="DD-MM-YYYY">DD-MM-YYYY</option>
                                <option value="MM-YYYY">MM-YYYY</option>
                            </select>
                        </div>
                    </ng-container>
                </th>
            </thead>
            <tbody [hidden]="rowsCollapsed">
                <tr *ngFor="let row of rows | slice:0:limitShown">
                    <td *ngFor="let col of columns"><ng-container *ngIf="uses[col] !== 'ignore'">{{row[col]}}</ng-container></td>
                </tr>
            </tbody>
        </table>
    </ng-container>
    <div class="d-flex justify-content-between">
        <div class="btn-group" data-toggle="buttons" *ngIf="dataAvailable()">
            <button type="button" class="btn btn-primary" (click)="store()">{{'STATISTICS.STORE' |
                translateHs : {app} }}</button>
            <button type="button" class="btn btn-secondary" (click)="visualizeInMap()">{{'STATISTICS.VISUALIZE_MAP'
                |
                translateHs : {app} }}</button>
        </div>

        <ng-container *ngIf="!rowsCollapsed && dataAvailable()">
            <div class="btn-group" data-toggle="buttons"><button type="button" class="btn bts-sm btn-secondary"
                    (click)="rowsShown('more')">{{'COMMON.more' |
                    translateHs : {app} }}</button>
                <button type="button" class="btn bts-sm btn-secondary" (click)="rowsShown('less')">{{'COMMON.less'
                    |
                    translateHs : {app} }}</button>
            </div>
        </ng-container>
    </div>
</div>